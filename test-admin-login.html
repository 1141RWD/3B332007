<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†å“¡ç™»å…¥æ¸¬è©¦</title>
  <script src="js/data.js"></script>
  <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
  <script src="js/coupon-system.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 1rem 2rem;
      margin: 0.5rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
    }
    .btn-test { background: #2196F3; color: white; }
    .btn-clear { background: #F44336; color: white; }
    .btn-check { background: #4CAF50; color: white; }
    .result {
      margin-top: 1rem;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ç®¡ç†å“¡ç™»å…¥æ¸¬è©¦å·¥å…·</h1>
  
  <div class="test-card">
    <h2>æ­¥é©Ÿ 1: æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥</h2>
    <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ¸¬è©¦ç®¡ç†å“¡å¸³è™Ÿç™»å…¥</p>
    <button class="btn-test" onclick="testAdminLogin()">
      ğŸ§ª æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥
    </button>
    <div id="loginResult" class="result"></div>
  </div>
  
  <div class="test-card">
    <h2>æ­¥é©Ÿ 2: æª¢æŸ¥ç•¶å‰ç™»å…¥ç‹€æ…‹</h2>
    <button class="btn-check" onclick="checkCurrentUser()">
      ğŸ‘¤ æª¢æŸ¥ç•¶å‰ç”¨æˆ¶
    </button>
    <div id="userResult" class="result"></div>
  </div>
  
  <div class="test-card">
    <h2>æ­¥é©Ÿ 3: æª¢æŸ¥ localStorage</h2>
    <button class="btn-check" onclick="checkLocalStorage()">
      ğŸ’¾ æŸ¥çœ‹ localStorage
    </button>
    <div id="storageResult" class="result"></div>
  </div>
  
  <div class="test-card">
    <h2>æ­¥é©Ÿ 4: æ¸…é™¤ä¸¦é‡æ–°æ¸¬è©¦</h2>
    <button class="btn-clear" onclick="clearAndTest()">
      ğŸ”„ æ¸…é™¤å¾Œé‡æ–°æ¸¬è©¦
    </button>
    <button class="btn-check" onclick="goToAdmin()">
      ğŸš€ å‰å¾€ç®¡ç†å¾Œå°
    </button>
  </div>
  
  <script>
    function log(elementId, message) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      console.log(message);
    }
    
    function testAdminLogin() {
      log('loginResult', 'æ­£åœ¨æ¸¬è©¦...\n');
      
      // æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥
      const result = authenticateUser('admin@morning-glory.com', 'admin123');
      
      const output = `
æ¸¬è©¦çµæœï¼š
========================================
æˆåŠŸ: ${result.success}
è§’è‰²: ${result.role}
è¨Šæ¯: ${result.message || 'ç™»å…¥æˆåŠŸ'}

ç”¨æˆ¶è³‡æ–™:
${JSON.stringify(result.user, null, 2)}

localStorage ä¸­çš„è³‡æ–™:
${localStorage.getItem('currentUser')}
      `;
      
      log('loginResult', output);
    }
    
    function checkCurrentUser() {
      const savedUser = localStorage.getItem('currentUser');
      
      if (!savedUser) {
        log('userResult', 'âŒ æ²’æœ‰ç™»å…¥ç”¨æˆ¶');
        return;
      }
      
      try {
        const user = JSON.parse(savedUser);
        const output = `
ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼š
========================================
Email: ${user.email}
åç¨±: ${user.name}
è§’è‰²: ${user.role}
ç™»å…¥æ™‚é–“: ${user.loginTime || 'æœªè¨˜éŒ„'}

æ˜¯å¦ç‚ºç®¡ç†å“¡: ${user.role === 'admin' ? 'âœ… æ˜¯' : 'âŒ å¦'}

å®Œæ•´è³‡æ–™:
${JSON.stringify(user, null, 2)}
        `;
        log('userResult', output);
      } catch (e) {
        log('userResult', 'âŒ è§£æç”¨æˆ¶è³‡æ–™å¤±æ•—:\n' + e.message);
      }
    }
    
    function checkLocalStorage() {
      const output = `
localStorage å…§å®¹ï¼š
========================================
currentUser: ${localStorage.getItem('currentUser') || 'ç„¡'}

users: ${localStorage.getItem('users') || 'ç„¡'}

contact_messages: ${localStorage.getItem('contact_messages') || 'ç„¡'}

æ‰€æœ‰éµå€¼:
${Object.keys(localStorage).join('\n')}
      `;
      log('storageResult', output);
    }
    
    function clearAndTest() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤ currentUser ä¸¦é‡æ–°æ¸¬è©¦å—ï¼Ÿ')) {
        localStorage.removeItem('currentUser');
        log('loginResult', 'âœ… å·²æ¸…é™¤ currentUser\nè«‹é»æ“Šã€Œæ¸¬è©¦ç®¡ç†å“¡ç™»å…¥ã€é‡æ–°æ¸¬è©¦');
      }
    }
    
    function goToAdmin() {
      const savedUser = localStorage.getItem('currentUser');
      if (!savedUser) {
        alert('è«‹å…ˆé€²è¡Œç®¡ç†å“¡ç™»å…¥æ¸¬è©¦');
        return;
      }
      
      try {
        const user = JSON.parse(savedUser);
        if (user.role !== 'admin') {
          alert('ç•¶å‰ç”¨æˆ¶ä¸æ˜¯ç®¡ç†å“¡ï¼Œç„¡æ³•è¨ªå•å¾Œå°');
          return;
        }
        
        window.location.href = 'admin.html';
      } catch (e) {
        alert('ç”¨æˆ¶è³‡æ–™éŒ¯èª¤: ' + e.message);
      }
    }
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
    window.addEventListener('load', () => {
      checkCurrentUser();
    });
  </script>
</body>
</html>